/* Edamame Security Analyzer - Dashboard Styles (static/style.css)
   ユーザー管理のテーブルとモーダルを含む基本スタイル
*/

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f5f7fa;
  color: #333;
  margin: 0;
  line-height: 1.6;
}

.dashboard-container { min-height: 100vh; display:flex; flex-direction:column; }
.app-body { display:flex; gap:1rem; padding:1.5rem; }
.sidebar { width:240px; min-width:240px; max-width:240px; flex:0 0 240px; background:#fff; border-radius:8px; padding:1rem; box-shadow:0 2px 8px rgba(0,0,0,0.06); height:calc(100vh - 120px); overflow:auto; }
.sidebar .nav-link { display:block; padding:0.5rem 0.75rem; color:#333; text-decoration:none; border-radius:6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.sidebar .nav-link:hover, .sidebar .nav-link.active { background:linear-gradient(90deg,#eef2ff,#f5f7ff); color:#222; }

/* サイドバー内のユーザー表示調整 */
.sidebar .sidebar-user-footer {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.sidebar .user-avatar {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.avatar-circle {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 600;
  font-size: 0.95rem;
}

.sidebar .user-name {
  font-weight: 600;
  font-size: 0.95rem;
  max-width: 120px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

#main-content.right-content { flex:1 1 auto; padding:1rem; min-height:calc(100vh - 120px); }
.card { background:white; border-radius:10px; padding:1.5rem; box-shadow:0 2px 10px rgba(0,0,0,0.1); }

/* テーブル */
table.table { width:100%; border-collapse:collapse; margin-top:.5rem; table-layout:fixed; }
table.table th, table.table td { padding:.6rem .75rem; border-bottom:1px solid #e6e9ef; text-align:left; vertical-align:middle; }
table.table thead th { background:#f8fafc; font-weight:600; cursor:pointer; user-select:none; }
table.table thead th.sorted-asc::after { content:' ▲'; font-size:0.8em; color:#666; }
table.table thead th.sorted-desc::after { content:' ▼'; font-size:0.8em; color:#666; }
tr:hover { background: #fafcff; }

/* ユーザー管理・サーバー管理のリストは行・ヘッダーとも改行させず省略表示 */
#user-results table.table th,
#user-results table.table td,
#server-results table.table th,
#server-results table.table td {
  white-space: nowrap;
  word-break: normal;
}

/* ユーザー管理テーブルのカラム幅調整: 状態を縮小しメール幅を拡大 */
#user-results table.table th#th-email, #user-results table.table td:nth-child(2) { min-width: 220px; width: 40%; }
#user-results table.table th#th-enabled, #user-results table.table td:nth-child(4) { width: 80px; min-width: 72px; text-align:center; }

/* カラム最小幅を指定して重なり防止（ユーザー管理） */
#user-results table.table th:nth-child(1), #user-results table.table td:nth-child(1) { min-width: 100px; width: 30%; }
#user-results table.table th:nth-child(2), #user-results table.table td:nth-child(2) { min-width: 150px; width: 40%; }
#user-results table.table th:nth-child(3), #user-results table.table td:nth-child(3) { min-width: 170px; width: 20%; }
#user-results table.table th:nth-child(4), #user-results table.table td:nth-child(4) { min-width: 80px; width: 10%; text-align:center; }

/* カラム最小幅を指定して重なり防止（サーバー管理） */
#server-results table.table th:nth-child(1), #server-results table.table td:nth-child(1) { min-width: 50px; width: 50%; }
#server-results table.table th:nth-child(2), #server-results table.table td:nth-child(2) { min-width: 50px; width: 35%; }
#server-results table.table th:nth-child(3), #server-results table.table td:nth-child(3) { min-width: 80px; width: 15%; text-align:center; }

/* ページネーション */
#pagination { margin-top: .75rem; display:flex; align-items:center; gap:.5rem; }
#pagination button { padding: .35rem .6rem; border-radius:6px; border:1px solid #d7dbe2; background:white; cursor:pointer; }
#pagination button:disabled { opacity: .5; cursor: not-allowed; }

/* モーダル */
.modal { position: fixed; inset: 0; display:flex; align-items:center; justify-content:center; z-index:1200; }
.modal[aria-hidden='true'] { display:none; }
.modal-backdrop { position:absolute; inset:0; background:rgba(0,0,0,0.45); }
.modal-content { position:relative; background:#fff; border-radius:10px; padding:1rem; width:480px; max-width:calc(100% - 2rem); box-shadow:0 10px 30px rgba(0,0,0,0.2); z-index:2; }
.modal-header { margin-bottom:.5rem; }
.modal-body { margin-bottom:.75rem; }
.modal-footer { display:flex; gap:.5rem; justify-content:flex-end; }

/* モーダル内の読み取り値表示 */
.form-value {
  padding: .45rem .5rem;
  border: 1px solid #d7dbe2;
  border-radius: 6px;
  background: #f8f9fc;
  min-height: 34px;
  display: flex;
  align-items: center;
}

/* 複数行のラベル整列改善 */
.modal .form-row { gap: .25rem; }
.modal .form-row { margin-bottom:.5rem; display:flex; flex-direction:column; }
.modal .form-row label { font-size:.85rem; margin-bottom:.25rem; }
.modal .form-row input[type='text'], .modal .form-row input[type='email'], .modal .form-row input[type='password'] { padding:.45rem .5rem; border:1px solid #d7dbe2; border-radius:6px; width:100%; }

/* チェックボックス行を横並びにして左寄せする（.form-row はデフォルトで column なので上書き） */
.modal .form-row.checkbox { flex-direction: row; align-items: center; }
.modal .form-row.checkbox label { margin: 0 0 0 0.25rem; }
.modal .form-row.checkbox input[type='checkbox'] { margin: 0; }

/* 横並びで左寄せしたい行用 (例: プロフィールのメール行) */
.modal .form-row.row-inline { display:flex; flex-direction:row; align-items:center; gap:.5rem; justify-content:flex-start; width:100%; }
.modal .form-row.row-inline label { margin:0; width:5rem; text-align:left; }
.modal .form-row.row-inline .row-inner { flex:1; display:flex; gap:.5rem; align-items:center; min-width:0; }
.modal .form-row.row-inline .row-inner input[type='email'],
.modal .form-row.row-inline .row-inner input[type='text'] { flex:1; min-width:0; width:auto; }

/* 強制的に左寄せしたい場合のフォールバックルール */
.modal .form-row.row-inline { margin-left:0 !important; padding-left:0 !important; justify-content:flex-start !important; }
.modal .form-row.row-inline label { margin-left:0 !important; }
.modal .form-row.row-inline .row-inner { justify-content:flex-start !important; }
.modal-content { padding-left:1rem !important; padding-right:1rem !important; }

/* Override: row-inline 内の input が全幅 rule に上書きされるケースを防ぐ */
.modal .form-row.row-inline .row-inner input[type='email'],
.modal .form-row.row-inline .row-inner input[type='text'] {
  width: auto !important; /* ensure it does not force full width */
  flex: 1 1 auto !important;
}
.modal .form-row.row-inline .row-inner button {
  flex: 0 0 auto !important;
  white-space: nowrap;
}

/* 警告ボタン */
.modal .danger { background:#ff6b6b; color:white; border:none; padding:.45rem .75rem; border-radius:6px; cursor:pointer; }
.modal button { padding:.45rem .75rem; border-radius:6px; border:1px solid #d7dbe2; cursor:pointer; background:white; }

/* small helpers */
.hidden { display:none !important; }

/* Sidebar mini menu */
.sidebar-mini-menu {
  min-width: 140px; /* 既存180pxから縮小 */
  max-width: 270px;
}
.sidebar-mini-menu .mini-menu-card {
  background: white; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.12); padding:.35rem; display:flex; flex-direction:column; gap:.25rem;
}
.sidebar-mini-menu .mini-menu-item { background:transparent; border:none; text-align:left; padding:.4rem 0.5rem; cursor:pointer; border-radius:6px; font-size: 0.95rem; }
.sidebar-mini-menu .mini-menu-item:hover { background: #f0f4ff; }

/* ミニメニューの表示位置: ユーザー表示のすぐ近くに出す */
.sidebar .sidebar-user-footer { position: relative; }
.sidebar-mini-menu { position: absolute; right: 8px; bottom: 48px; z-index: 1500; display: none; }
.sidebar-mini-menu.show { display: block; }

/* 非表示ミニメニューはポインター無効化（モーダル操作阻害防止） */
.sidebar-mini-menu[aria-hidden='true'] { pointer-events: none; }
.sidebar-mini-menu.show { pointer-events: auto; }

/* profile modal tweaks */
.modal .form-row input[type='text'], .modal .form-row input[type='email'], .modal .form-row input[type='password'] { width:100%; }
.modal .modal-footer { justify-content:flex-end; }

/* 確認モーダル（サーバー管理用）: URL脅威度と同じ制御に合わせる */
#confirm-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.35); z-index: 1600; }
#confirm-modal { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 1701; }
#confirm-modal.hidden, #confirm-backdrop.hidden { display: none !important; }
#confirm-modal .modal-content { position: relative; background: #fff; padding: 1rem; border-radius: 10px; width: 480px; max-width: 94vw; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }

/* モーダル表示時はミニメニューを強制的に無効化/非表示 */
.sidebar-mini-menu.server-mini { z-index: 1400; }

/* 余計な高 z-index を削除し、1701/1600 帯で固定 */

/* URL脅威度ビュー専用スタイル（元のHTML内styleをCSSへ移植） */
.url-threat-row { display:flex; gap:0.75rem; align-items:center; flex-wrap:wrap; }
.url-threat-filter-row { margin-top:0.75rem; display:flex; gap:0.75rem; align-items:center; flex-wrap:wrap; }
.url-threat-filter-row label { margin-right:0.75rem; }
.url-threat-filter-label { margin-right:0.75rem; }
.url-threat-search { margin-top:0.5rem; }
.url-threat-message { margin-top:0.75rem; color:#555; }
.url-threat-table-wrap { margin-top:0.75rem; }
.url-threat-pager { margin-top:0.5rem; display:flex; gap:0.5rem; align-items:center; }
.url-threat-count { margin-top:0.25rem; font-size:0.9em; color:#444; }
.url-threat-legend { margin-top:0.5rem; font-size:0.9em; color:#555; }
.threat-safe { background:#e6f6e9; color:#1c7c3d; }
.threat-danger { background:#fde8e8; color:#b42318; }
.threat-caution { background:#fff4e5; color:#a15c00; }
.threat-unknown { background:#eef2f6; color:#3f4a5a; }
#url-threat-table tbody tr.threat-safe { border-left:4px solid #1c7c3d; }
#url-threat-table tbody tr.threat-danger { border-left:4px solid #b42318; }
#url-threat-table tbody tr.threat-caution { border-left:4px solid #a15c00; }
#url-threat-table tbody tr.threat-unknown { border-left:4px solid #5b6473; }
.threat-col { min-width: 96px; width: 100px; max-width: 120px; text-align:center; white-space: nowrap; }
.url-col { width: auto; }
.method-col { min-width: 90px; width: 100px; max-width: 140px; text-align:left; white-space: nowrap; }
.attack-col { min-width: 128px; width: 140px; max-width: 180px; white-space: nowrap; }
.access-col { width: 170px; max-width: 170px; white-space: nowrap; }
.status-col { width: 70px; max-width: 70px; text-align:center; }
.modsec-col { width: 80px; max-width: 80px; }
#url-threat-table { table-layout: auto; }
#url-threat-table td.url-cell { min-width: 240px; max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; mask-image: linear-gradient(90deg, #000 85%, rgba(0,0,0,0)); }
#url-threat-table td.threat-cell { min-width: 96px; text-align:center; white-space: nowrap; }
#url-threat-table td.method-cell { min-width: 90px; max-width: 140px; text-align:left; white-space: nowrap; overflow:hidden; text-overflow:ellipsis; }
#url-threat-table td.attack-cell { min-width: 128px; white-space: nowrap; overflow:hidden; text-overflow:ellipsis; }
#url-threat-table td.access-cell { white-space: nowrap; overflow:hidden; text-overflow:ellipsis; }
#url-threat-table td.status-cell { text-align:center; white-space: nowrap; }
#url-threat-table td.modsec-cell { text-align:left; white-space: nowrap; overflow:hidden; text-overflow:ellipsis; }
#url-threat-search-form input { width:100%; max-width:100%; }
#url-threat-body tr { cursor: pointer; }
#url-threat-mini-menu { position:absolute; display:none; z-index:1700; }
#url-suppression-mini-menu { position:absolute; display:none; z-index:1700; }
#url-threat-mini-menu .mini-menu-item[disabled] { opacity:0.5; cursor:not-allowed; }
#url-suppression-mini-menu .mini-menu-item[disabled] { opacity:0.5; cursor:not-allowed; }
#url-threat-mini-menu .mini-menu-item.hidden { display:none; }
#url-suppression-mini-menu .mini-menu-item.hidden { display:none; }
#url-suppression-results tbody tr { cursor:pointer; }
#url-threat-modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.35); z-index:1600; }
#url-threat-note-modal { z-index:1701; }
.url-threat-note-content { width:480px; max-width:94vw; }
.url-threat-modal-url { font-size:0.9em; word-break:break-all; }
#url-threat-note-text { width:100%; }
.url-threat-note-hint { color:#666; font-size:0.9em; }
.url-threat-note-footer { justify-content:flex-end; gap:0.5rem; }

/* 画面レスポンシブ */
@media (max-width:800px) {
  .sidebar { display:none; }
  .app-body { padding: .75rem; }
  .modal-content { width: 92%; }
}

/* サイドメニューは常にフルサイズ表示 */
.sidebar { display:block !important; }

/* 強制オーバーライド: row-inline の入力とボタンを横並びに固定する（最後に追加） */
.modal-content .form-row.row-inline { display:flex !important; align-items:center !important; gap:.5rem !important; }
.modal-content .form-row.row-inline label { width:5rem !important; }
.modal-content .form-row.row-inline .row-inner { display:flex !important; align-items:center !important; gap:.5rem !important; min-width:0 !important; }
.modal-content .form-row.row-inline .row-inner input[type='email'],
.modal-content .form-row.row-inline .row-inner input[type='text'] {
  width: auto !important;
  flex: 1 1 auto !important;
  min-width: 0 !important;
}
.modal-content .form-row.row-inline .row-inner button {
  flex: 0 0 auto !important;
  white-space: nowrap !important;
}

/* 検索フォームをフル幅に伸ばす */
.search-form { display:flex; width:100%; margin-bottom:.75rem; }
.search-form input[type='text'] { flex:1 1 auto; width:100%; max-width:100%; }

/* ユーザー/サーバー管理リストの表示領域を固定し、縦スクロールを許可 */
#user-results,
#server-results {
  max-height: 60vh;
  min-height: 360px;
  overflow-y: auto;
  overflow-x: auto; /* 横方向のスクロールも許可 */
}

/* ユーザー/サーバー管理テーブルは最小幅を確保し、横スクロールで全項目確認可能にする */
#user-results table.table,
#server-results table.table {
  min-width: 900px;
}

#server-results-body tr.inactive,
#url-suppression-body tr.inactive {
  background: #f6f7fb;
  color: #666;
}

/* URL抑止ミニメニューのスタイル調整 */
#url-suppression-mini-menu { position:absolute; display:none; z-index:1700; }
#url-suppression-mini-menu .mini-menu-card {
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  padding: .35rem;
  display: flex;
  flex-direction: column;
  gap: .25rem;
}
#url-suppression-mini-menu .mini-menu-item {
  background: transparent;
  border: none;
  text-align: left;
  padding: .4rem 0.5rem;
  cursor: pointer;
  border-radius: 6px;
  font-size: 0.95rem;
  width: 100%;
}
#url-suppression-mini-menu .mini-menu-item:hover { background: #f0f4ff; }
#url-suppression-mini-menu .mini-menu-item[disabled] { opacity:0.5; cursor:not-allowed; }
#url-suppression-mini-menu .mini-menu-item.hidden { display:none; }

/* URL抑止結果テーブルのセルに対するスタイル追加 */
#url-suppression-results table.table th,
#url-suppression-results table.table td {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
#url-suppression-results table.table td.mono {
  mask-image: linear-gradient(90deg, #000 85%, rgba(0,0,0,0));
}

