<!-- URL脅威度断片: サーバーごとのURL脅威一覧を表示する -->
<div class="card">
  <h2>URL脅威度</h2>

  <div class="form-row url-threat-row">
    <label for="url-threat-server">サーバー</label>
    <select id="url-threat-server" aria-label="サーバー選択"></select>
  </div>

  <div class="form-row url-threat-filter-row">
    <span class="url-threat-filter-label">表示する脅威度</span>
    <label><input type="radio" name="url-threat-filter" value="all" checked /> すべて表示</label>
    <label><input type="radio" name="url-threat-filter" value="danger" /> 危険</label>
    <label><input type="radio" name="url-threat-filter" value="caution" /> 注意</label>
    <label><input type="radio" name="url-threat-filter" value="unknown" /> 不明</label>
    <label><input type="radio" name="url-threat-filter" value="safe" /> 安全</label>
  </div>

  <div id="url-threat-search-form" class="search-form url-threat-search">
    <input type="text" id="url-threat-q" name="q" placeholder="URL・攻撃タイプ・メソッドで検索" aria-label="URL脅威度検索" />
  </div>

  <div id="url-threat-message" class="url-threat-message"></div>

  <div class="table-responsive url-threat-table-wrap">
    <table class="table" id="url-threat-table">
      <thead>
        <tr>
          <th scope="col" class="threat-col">脅威度</th>
          <th scope="col" class="url-col">URL</th>
          <th scope="col" class="method-col">メソッド</th>
          <th scope="col" class="attack-col">攻撃タイプ</th>
          <th scope="col" class="access-col">最終アクセス</th>
          <th scope="col" class="status-col">HTTP</th>
          <th scope="col" class="modsec-col">ModSec</th>
        </tr>
      </thead>
      <tbody id="url-threat-body">
        <tr><td colspan="7">読み込み中...</td></tr>
      </tbody>
    </table>
  </div>
  <div id="url-threat-pager" class="url-threat-pager"></div>
  <div id="url-threat-count" class="url-threat-count"></div>

  <div class="legend url-threat-legend">
    <span class="badge threat-danger">危険</span>
    <span class="badge threat-caution">注意</span>
    <span class="badge threat-unknown">不明</span>
    <span class="badge threat-safe">安全</span>
  </div>
</div>

<div id="url-threat-mini-menu" class="sidebar-mini-menu url-threat-mini" role="menu" aria-hidden="true">
  <div class="mini-menu-card">
    <button class="mini-menu-item" data-action="copy">URLをコピー</button>
    <button class="mini-menu-item" data-action="danger">アクセスを危険にカテゴリーする</button>
    <button class="mini-menu-item" data-action="safe">アクセスを安全にカテゴリーする</button>
    <button class="mini-menu-item" data-action="clear">カテゴリーを解除する</button>
    <button class="mini-menu-item" data-action="note">カテゴリーされた理由を確認する</button>
  </div>
</div>
<div id="url-threat-modal-backdrop" class="modal-backdrop hidden"></div>
<div id="url-threat-note-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="url-threat-note-title">
  <div class="modal-content url-threat-note-content">
    <div class="modal-header">
      <h3 id="url-threat-note-title">理由を入力</h3>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <label>対象URL</label>
        <div id="url-threat-modal-url" class="url-threat-modal-url"></div>
      </div>
      <div class="form-row">
        <label for="url-threat-note-text">理由</label>
        <textarea id="url-threat-note-text" rows="5"></textarea>
      </div>
      <div id="url-threat-note-hint" class="url-threat-note-hint"></div>
    </div>
    <div class="modal-footer url-threat-note-footer">
      <button type="button" id="url-threat-note-cancel">閉じる</button>
      <button type="button" id="url-threat-note-save" class="danger">保存</button>
    </div>
  </div>
</div>

<script src="/static/mini_menu.js"></script>
<script>
  // フラグメント挿入後に初期化
  setTimeout(function(){
    try { if (window.UrlThreat && typeof window.UrlThreat.init === 'function') { window.UrlThreat.init(); } }
    catch(e){ console.error('UrlThreat init error', e); }
  }, 0);
</script>
