<!-- サーバー管理断片（ユーザー管理の仕様を流用） -->
<div class="card">
  <h2>サーバー管理</h2>

  <!-- 検索フォーム: ユーザー管理と同様に入力時に自動検索 -->
  <div id="server-search-form" class="search-form">
    <input type="text" id="server-q" name="q" placeholder="サーバー名で検索" aria-label="サーバー検索" />
  </div>

  <!-- 検索結果テーブル -->
  <div id="server-results">
    <table class="table">
      <thead>
        <tr>
          <th id="th-servername" data-column="serverName" scope="col">サーバー名</th>
          <th id="th-lastLog" data-column="lastLogReceived" scope="col">最終ログ受信</th>
          <th id="th-active" data-column="isActive" scope="col">状態</th>
        </tr>
      </thead>
      <tbody id="server-results-body">
        <!-- 初期は空。検索後にサーバーからJSONを取得して描画 -->
      </tbody>
    </table>
    <div id="server-pagination" class="pagination"></div>
    <div class="hint" style="margin-top:.5rem; font-size:0.9em; color:#666;">20件まで表示し、それ以上はページ分割します。</div>
  </div>
</div>

<!-- コンテキストメニュー（行クリックで表示）: mini_menu.js を使用 -->
<div id="server-context-menu" class="mini-menu server-mini" aria-hidden="true">
  <div class="mini-menu-card"></div>
</div>

<!-- 確認モーダル（無効化の確認用）: バックドロップを兄弟要素に分離し hidden クラスで制御 -->
<div id="confirm-backdrop" class="modal-backdrop hidden"></div>
<div id="confirm-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="confirm-modal-title">
  <div class="modal-content" role="document">
    <header class="modal-header"><h3 id="confirm-modal-title">操作確認</h3></header>
    <main class="modal-body">
      <p id="confirm-modal-message">この操作を実行しますか？</p>
    </main>
    <footer class="modal-footer" style="display:flex;gap:.5rem;justify-content:flex-end;">
      <button id="confirm-cancel" type="button">キャンセル</button>
      <button id="confirm-ok" type="button">実行</button>
    </footer>
  </div>
</div>

<!-- mini_menu.js と server_list.js を読み込み、断片挿入後に初期化を行う -->
<script src="/static/mini_menu.js"></script>
<script src="/static/server_list.js"></script>
<script>
  // フラグメントが DOM に挿入された後に呼ばれる想定なので、少し遅延して初期化を試みる
  (function(){
    try {
      // URL の q パラメータがあれば初期検索に渡す
      const initialQ = new URLSearchParams(window.location.search).get('q');
      window.ServerList && window.ServerList.initServerManagement && window.ServerList.initServerManagement(initialQ);
    } catch(e) { console.error('ServerList init error', e); }
  })();
</script>
