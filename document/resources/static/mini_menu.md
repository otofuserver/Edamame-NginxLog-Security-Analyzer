# mini_menu.js

対象: `src/main/resources/static/mini_menu.js`

## 概要
- サーバー管理・URL脅威度など複数画面で再利用する共通ミニメニューパーツのJSロジック。
- クリック位置近くにミニメニューを表示し、外側クリックや Escape で閉じる挙動を統一する。

## 主な機能
- 指定ターゲット要素に対するミニメニュー表示/非表示の制御。
- クリック座標に基づいた表示位置計算とViewport内へのクリッピング。
- 外側クリック・Escapeキーでのクローズ処理（毎回復帰するため一度きりで終わらない）。
- aria-hidden/inert を用いたフォーカス管理の配慮（フォーカス中要素は hidden にしない）。

## 挙動
- `show({x,y,items})` で座標を指定して表示し、`hide()` で非表示にする（再表示前に毎回リセット）。
- メニュー内クリックは閉じないが、他行クリック時は一度閉じてから新規に開く。
- `document` レベルのクリック/keydown リスナーで再入可能にし、外側クリックは suppress カウンタで意図しない即時クローズを防ぐ。

## 細かい指定された仕様
- aria 警告対策として、フォーカスが当たる要素やその祖先に `aria-hidden="true"` を付与しない。必要に応じて `inert` で操作抑止のみを行う。
- z-index 1700 をデフォルトとし、サーバー管理用は 1400 に下げてモーダルと干渉しない（クラス `server-mini`）。
- 位置計算はメニュー幅/高さを考慮し、画面外に出ないよう補正する。
- 外観は `mini_menu.css` の `.mini-menu` / `.mini-menu-card` / `.mini-menu-item` を利用し、JS は見た目を直接持たない。

## その他
- スタイルは `src/main/resources/static/mini_menu.css` に集約し、HTML 側で `mini-menu` クラスを付与して再利用する。

## 変更履歴
- 2026-01-20: スタイルを `mini_menu.css` に分離し、共通クラス名を `mini-menu` に統一する運用に更新。
- 2026-01-15: 共通ミニメニューを独立ファイル化し、外側クリックが一度しか動かない問題と aria-hidden 警告を解消。
