# Edamame Server-side Agent Processing 仕様書

## server_agent_spec.md バージョン情報
- **server_agent_spec.md version**: v1.2.3
- **最終更新**: 2025-08-09
- ※このファイルを更新した場合は、必ず上記バージョン情報も更新すること

---

## 概要
Edamame Server-side Agent Processingは、エージェントから送信されたログデータをバックエンドサーバー側で処理する機能です。TCP通信で受信したログを解析し、データベースに適切に保存します。

**v1.2.3の主要改善**: LogMonitor完全廃止・サーバー側での生ログパース/デコード処理の廃止

---

## v1.2.3での重要変更（2025-08-09）

### LogMonitor完全廃止・サーバー側での生ログパース/デコード処理の廃止

- **LogMonitorクラスを完全廃止**（サーバー・エージェント両方）
- **サーバー側での生ログパース（LogParserによるファイル直接読取）は廃止**
- **URLデコードはagent受信時のみ1回だけ実施**
- **以降の全処理はデコード済み値を使い回す**
- **サーバー側でのLogParserによるdecode処理は不要**
- これにより、パフォーマンス・データ整合性・保守性が大幅に向上

#### データフロー（v1.2.3以降）
```
1. エージェントがログを収集し、必要なデコード・パースを実施
2. サーバーはagentから受信したデータをそのまま利用（再decode不要）
3. DB保存・攻撃判定・ホワイトリスト判定等は全てデコード済み値で統一
```

#### 仕様上の注意
- サーバー側で生ログファイルを直接パースする運用は**今後一切行わない**
- LogParserのdecode処理は廃止済み（agent経由のみのため）
- decode/encodeはUrlCodecユーティリティで一元管理

---

## v1.2.2以前の主な仕様・修正履歴
（※省略。詳細は過去バージョンの記述を参照）

---

## 仕様変更履歴
- v1.2.3: LogMonitor完全廃止、サーバー側での生ログパース・decode処理廃止、agent経由専用化
- v1.2.2: ホワイトリストsafe→unsafeバグ修正、安全性保持ロジック実装
- v1.2.1: AgentTcpServerビルドエラー修正、ホワイトリスト機能動作確認
- v1.2.0: 攻撃パターン識別の統合処理、データ整合性保証