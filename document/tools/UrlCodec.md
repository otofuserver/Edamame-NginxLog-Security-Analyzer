# UrlCodec.java 仕様書

## 役割
- URLのエンコード・デコード専用ユーティリティクラス。
- Java 21の標準APIを利用し、UTF-8固定で動作。
- 多重エンコードされたURLも自動的に必要な回数だけデコード可能。
- 静的メソッドのみを提供し、インスタンス化不可。

## 主なメソッド
- `public static String decode(String url)`
  - %エンコーディングされたURLを通常文字列にデコード。
  - 多重エンコードにも対応し、最大5回まで自動的に再帰デコード。
  - デコード前後で変化がなくなるか、%が含まれなくなるまで繰り返す。
  - 例外発生時は直前の値を返却。
- `public static String encode(String value)`
  - 文字列をURLエンコード（UTF-8固定）。
  - 例外発生時は元の値を返却。

## ロジック
- decodeは+をスペースに変換後、URLDecoder.decodeを使用。
- 多重エンコード対応のため、最大5回までループし、デコード前後で変化がなければ終了。
- encodeはURLEncoder.encodeを使用。
- いずれもnull入力時はnullを返却。

## 利用方針（v1.2.3以降）
- **サーバー側での生ログパース時はdecode不要**（LogMonitor廃止・agent経由専用化のため）
- **URLデコードはagent受信時のみ1回だけ実施**
- 以降の全処理はデコード済み値を使い回す
- 他クラスでURLデコード・エンコードが必要な場合は必ず本クラスを利用すること

## 注意事項
- インスタンス化禁止（privateコンストラクタ）。
- 例外発生時は安全に元の値または直前の値を返す。
- UTF-8固定で動作。

---

### 参考：実装例
- decode/encodeはpublic staticメソッドとして実装。
- 多重エンコード対応のため、decodeはループ処理を実装。
- 例外時はcatchで安全に値を返却。
